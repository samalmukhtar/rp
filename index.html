<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>جدول تمارين المنزل مع Bar وDumbbell</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      direction: rtl;
      margin: 0;
      padding: 15px;
    }
    h2 {
      color: #f8b500;
      text-align: center;
    }
    .week-selector {
      text-align: center;
      margin-bottom: 20px;
    }
    select, button {
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
    }
    button {
      background-color: #f8b500;
      color: black;
      font-weight: bold;
    }
    .day-section {
      background-color: #1e1e1e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      text-align: center;
      color: #fff;
    }
    th {
      background-color: #f8b500;
      color: black;
    }
    input[type="number"], input[type="text"] {
      width: 100%;
      background-color: #333;
      color: #fff;
      border: none;
      padding: 4px;
      font-size: 13px;
      text-align: center;
    }
    .delete-exercise {
      background-color: #c62828;
      color: white;
      border: none;
      padding: 4px 7px;
      border-radius: 3px;
      cursor: pointer;
    }
    textarea {
      width: 100%;
      min-height: 70px;
      background-color: #333;
      color: #fff;
      border: none;
      padding: 7px;
      font-size: 14px;
      resize: vertical;
    }
    label {
      display: block;
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: bold;
      color: #f8b500;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>جدول تمارين المنزل مع Bar وDumbbell</h2>
  <div class="week-selector">
    <label for="weekSelect">اختر الأسبوع:</label>
    <select id="weekSelect"></select>
    <button onclick="addWeek()">➕ إضافة أسبوع</button>
    <button onclick="exportPDF()">📄 تصدير PDF</button>
    <button onclick="clearAllData()">🗑️ مسح البيانات</button>
  </div>
  <div id="weeksContainer"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>

<script>
  const daysOfWeek = ["السبت", "الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة"];

  // بيانات البداية
  let data = {
    weeks: [
      {
        name: "الأسبوع 1",
        days: {
          "السبت": [
            {name:"سكوات بدون معدات - Home Game", sessions:"3", reps:"12", weight:"0", percent:"0", duration:"10", progress:"0"},
            {name:"بريس الصدر بالبار - Bar", sessions:"3", reps:"10", weight:"20", percent:"70", duration:"15", progress:"0"},
            {name:"تمرين العضلة ذات الرأسين دمبل - Dumbbell", sessions:"3", reps:"12", weight:"8", percent:"75", duration:"10", progress:"0"}
          ],
          "الأحد": [
            {name:"جري في المكان - Home Game", sessions:"4", reps:"30", weight:"0", percent:"0", duration:"15", progress:"0"},
            {name:"ديدليفت بالبار - Bar", sessions:"3", reps:"8", weight:"40", percent:"80", duration:"20", progress:"0"},
            {name:"رفرفة جانبية دمبل - Dumbbell", sessions:"3", reps:"15", weight:"5", percent:"70", duration:"10", progress:"0"}
          ]
        }
      }
    ]
  };

  // تمارين مقترحة مع خوارزمية بسيطة للاقتراح
  const exerciseSuggestions = {
    "Bar": [
      { name: "سكوات بالبار", sessions: "3", reps: "8", weight: "40", percent: "80" },
      { name: "ديدليفت بالبار", sessions: "3", reps: "6", weight: "45", percent: "85" },
      { name: "ضغط عسكري بالبار", sessions: "3", reps: "8", weight: "30", percent: "75" }
    ],
    "Dumbbell": [
      { name: "تمرين الصدر بالدمبل", sessions: "3", reps: "10", weight: "10", percent: "75" },
      { name: "رفع الدمبل للأعلى", sessions: "3", reps: "12", weight: "6", percent: "70" },
      { name: "رفرفة جانبية دمبل", sessions: "3", reps: "15", weight: "5", percent: "70" }
    ],
    "Home Game": [
      { name: "بوش أب", sessions: "4", reps: "15", weight: "0", percent: "0" },
      { name: "قفز الحبل", sessions: "5", reps: "50", weight: "0", percent: "0" },
      { name: "شد جسم", sessions: "3", reps: "12", weight: "0", percent: "0" }
    ]
  };

  function saveData() {
    localStorage.setItem("gymWeeklyData", JSON.stringify(data));
  }

  function loadData() {
    const saved = localStorage.getItem("gymWeeklyData");
    if (saved) data = JSON.parse(saved);
  }

  function updateExercise(weekIdx, day, exIdx, field, value) {
    const exercise = data.weeks[weekIdx].days[day][exIdx];
    exercise[field] = value;
    exercise.progress = `${exercise.weight || 0} × ${exercise.reps || 0}`;
    const progressInput = document.querySelector(`#week-${weekIdx}-day-${day} tbody tr:nth-child(${exIdx + 1}) input.progress-field`);
    if (progressInput) progressInput.value = exercise.progress;
    saveData();
  }

  function deleteExercise(weekIdx, day, exIdx) {
    data.weeks[weekIdx].days[day].splice(exIdx, 1);
    saveData();
    renderWeekContent(weekIdx);
  }

  function addExercise(weekIdx, day, exercise = null) {
    const defaultEx = {
      name: "تمرين جديد",
      sessions: "1",
      reps: "10",
      weight: "0",
      percent: "0",
      duration: "10",
      progress: "0"
    };
    const newEx = exercise || defaultEx;
    data.weeks[weekIdx].days[day].push(newEx);
    saveData();
    renderWeekContent(weekIdx);
  }

  function createDayTable(weekIdx, day) {
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    const headers = ["التمرين", "الجلسات", "التكرار", "الوزن (كغ)", "النسبة %", "المدة (دقائق)", "التقدم", "إزالة"];
    headers.forEach(text => {
      const th = document.createElement("th");
      th.textContent = text;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    const exercises = data.weeks[weekIdx].days[day] || [];

    exercises.forEach((ex, exIdx) => {
      const tr = document.createElement("tr");

      // اسم التمرين (تعديل)
      const tdName = document.createElement("td");
      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.value = ex.name;
      nameInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "name", e.target.value);
      tdName.appendChild(nameInput);
      tr.appendChild(tdName);

      // الجلسات
      const tdSessions = document.createElement("td");
      const sessionsInput = document.createElement("input");
      sessionsInput.type = "number";
      sessionsInput.min = "0";
      sessionsInput.value = ex.sessions;
      sessionsInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "sessions", e.target.value);
      tdSessions.appendChild(sessionsInput);
      tr.appendChild(tdSessions);

      // التكرار
      const tdReps = document.createElement("td");
      const repsInput = document.createElement("input");
      repsInput.type = "number";
      repsInput.min = "0";
      repsInput.value = ex.reps;
      repsInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "reps", e.target.value);
      tdReps.appendChild(repsInput);
      tr.appendChild(tdReps);

      // الوزن
      const tdWeight = document.createElement("td");
      const weightInput = document.createElement("input");
      weightInput.type = "number";
      weightInput.min = "0";
      weightInput.value = ex.weight;
      weightInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "weight", e.target.value);
      tdWeight.appendChild(weightInput);
      tr.appendChild(tdWeight);

      // النسبة %
      const tdPercent = document.createElement("td");
      const percentInput = document.createElement("input");
      percentInput.type = "number";
      percentInput.min = "0";
      percentInput.value = ex.percent;
      percentInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "percent", e.target.value);
      tdPercent.appendChild(percentInput);
      tr.appendChild(tdPercent);

      // المدة
      const tdDuration = document.createElement("td");
      const durationInput = document.createElement("input");
      durationInput.type = "number";
      durationInput.min = "0";
      durationInput.value = ex.duration;
      durationInput.oninput = (e) => updateExercise(weekIdx, day, exIdx, "duration", e.target.value);
      tdDuration.appendChild(durationInput);
      tr.appendChild(tdDuration);

      // التقدم
      const tdProgress = document.createElement("td");
      const progressInput = document.createElement("input");
      progressInput.type = "text";
      progressInput.readOnly = true;
      progressInput.className = "progress-field";
      progressInput.value = ex.progress;
      tdProgress.appendChild(progressInput);
      tr.appendChild(tdProgress);

      // حذف
      const tdDelete = document.createElement("td");
      const delBtn = document.createElement("button");
      delBtn.textContent = "حذف";
      delBtn.className = "delete-exercise";
      delBtn.onclick = () => deleteExercise(weekIdx, day, exIdx);
      tdDelete.appendChild(delBtn);
      tr.appendChild(tdDelete);

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    return table;
  }

  function createDaySection(weekIdx, day) {
    const section = document.createElement("div");
    section.className = "day-section";

    const title = document.createElement("h3");
    title.textContent = day;
    section.appendChild(title);

    const table = createDayTable(weekIdx, day);
    section.appendChild(table);

    // قائمة منسدلة لاختيار تمرين جديد
    const dropdown = document.createElement("select");
    dropdown.innerHTML = `<option value="">اختيار تمرين جديد</option>`;
    Object.keys(exerciseSuggestions).forEach(category => {
      exerciseSuggestions[category].forEach(ex => {
        const option = document.createElement("option");
        option.value = JSON.stringify({...ex, duration: "15"});
        option.textContent = `${ex.name} (${category})`;
        dropdown.appendChild(option);
      });
    });
    dropdown.onchange = () => {
      if (dropdown.value) {
        const selectedEx = JSON.parse(dropdown.value);
        addExercise(weekIdx, day, selectedEx);
      }
    };
    section.appendChild(dropdown);

    // زر إضافة تمرين فارغ
    const addBtn = document.createElement("button");
    addBtn.textContent = "➕ إضافة تمرين فارغ";
    addBtn.onclick = () => addExercise(weekIdx, day);
    section.appendChild(addBtn);

    const labelNotes = document.createElement("label");
    labelNotes.textContent = "ملاحظات اليوم:";
    section.appendChild(labelNotes);

    const textarea = document.createElement("textarea");
    textarea.value = data.weeks[weekIdx].days[day].notes || "";
    textarea.placeholder = "أضف ملاحظاتك هنا...";
    textarea.oninput = (e) => {
      data.weeks[weekIdx].days[day].notes = e.target.value;
      saveData();
    };
    section.appendChild(textarea);

    return section;
  }

  function renderWeekContent(weekIdx) {
    const container = document.getElementById("weeksContainer");
    container.innerHTML = "";
    const week = data.weeks[weekIdx];
    if (!week) return;
    daysOfWeek.forEach(day => {
      if (!week.days[day]) week.days[day] = [];
      if (!week.days[day].notes) week.days[day].notes = "";
      const daySection = createDaySection(weekIdx, day);
      container.appendChild(daySection);
    });
  }

  function renderWeekSelector() {
    const select = document.getElementById("weekSelect");
    select.innerHTML = "";
    data.weeks.forEach((w, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = w.name;
      select.appendChild(option);
    });
    select.onchange = () => renderWeekContent(select.value);
    if (select.options.length > 0) {
      select.selectedIndex = 0;
      renderWeekContent(0);
    }
  }

  function addWeek() {
    const newWeekName = `الأسبوع ${data.weeks.length + 1}`;
    const newDays = {};
    daysOfWeek.forEach(day => newDays[day] = []);
    data.weeks.push({ name: newWeekName, days: newDays });
    saveData();
    renderWeekSelector();
    selectWeek(data.weeks.length - 1);
  }

  function selectWeek(idx) {
    const select = document.getElementById("weekSelect");
    select.value = idx;
    renderWeekContent(idx);
  }

  function clearAllData() {
    if (confirm("هل أنت متأكد أنك تريد مسح كل البيانات؟")) {
      localStorage.removeItem("gymWeeklyData");
      data = { weeks: [] };
      addWeek();
      renderWeekSelector();
    }
  }

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
      orientation: "portrait",
      unit: "pt",
      format: "a4"
    });

    // تحميل خط عربي
    const font = await fetch('https://fonts.gstatic.com/s/tajawal/v9/IgbvMIE1UvNlaic0ylGXSQ.woff2 ').then(res => res.arrayBuffer());
    const tajawalFont = new Uint8Array(font);
    doc.addFileToVFS("Tajawal-Regular.woff2", btoa(String.fromCharCode.apply(null, tajawalFont)));
    doc.addFont("Tajawal-Regular.woff2", "Tajawal", "normal");
    doc.setFont("Tajawal");

    let y = 60;

    doc.setFontSize(18);
    doc.setTextColor("#f8b500");
    doc.text("تقرير جدول التمارين الأسبوعي", 40, y);
    y += 30;

    data.weeks.forEach((week, wIndex) => {
      doc.setFontSize(14);
      doc.setTextColor("#f8b500");
      doc.text(week.name, 40, y);
      y += 20;

      daysOfWeek.forEach(day => {
        doc.setFontSize(12);
        doc.setTextColor("#ffffff");
        doc.text(day, 50, y);
        y += 15;

        const exercises = week.days[day] || [];

        if (exercises.length === 0) {
          doc.text("لا يوجد تمارين", 60, y);
          y += 15;
        } else {
          exercises.forEach(ex => {
            const line = `- ${ex.name || "بدون اسم"} | جلسات: ${ex.sessions || "-"} | تكرار: ${ex.reps || "-"} | وزن: ${ex.weight || "-"} كغ | نسبة: ${ex.percent || "-"}% | مدة: ${ex.duration || "-"} دقيقة | تقدم: ${ex.progress || "-"}`;
            const lines = doc.splitTextToSize(line, 500);
            doc.text(lines, 60, y);
            y += lines.length * 14;
            if (y > 750) {
              doc.addPage();
              y = 60;
            }
          });
        }

        if (week.days[day].notes && week.days[day].notes.trim()) {
          doc.setFontSize(11);
          doc.setTextColor("#aaaaaa");
          const notesLine = `ملاحظات: ${week.days[day].notes.trim()}`;
          const notesLines = doc.splitTextToSize(notesLine, 500);
          doc.text(notesLines, 60, y);
          y += notesLines.length * 14;
          if (y > 750) {
            doc.addPage();
            y = 60;
          }
        }

        y += 10;
      });

      y += 20;
      if (y > 750) {
        doc.addPage();
        y = 60;
      }
    });

    doc.save("جدول_التمارين_الأسبوعي.pdf");
  }

  loadData();
  if (data.weeks.length === 0) addWeek();
  renderWeekSelector();
</script>
</body>
</html>