<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø¬Ø¯ÙˆÙ„ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¹ Bar ÙˆDumbbell</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      direction: rtl;
      margin: 0;
      padding: 15px;
    }
    h2 {
      color: #f8b500;
      text-align: center;
    }
    .week-selector {
      text-align: center;
      margin-bottom: 20px;
    }
    select, button {
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
    }
    button {
      background-color: #f8b500;
      color: black;
      font-weight: bold;
    }
    .day-section {
      background-color: #1e1e1e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      text-align: center;
      color: #fff;
    }
    th {
      background-color: #f8b500;
      color: black;
    }
    input[type="number"], input[type="text"] {
      width: 100%;
      background-color: #333;
      color: #fff;
      border: none;
      padding: 4px;
      font-size: 13px;
      text-align: center;
    }
    .delete-exercise {
      background-color: #c62828;
      color: white;
      border: none;
      padding: 4px 7px;
      border-radius: 3px;
      cursor: pointer;
    }
    textarea {
      width: 100%;
      min-height: 70px;
      background-color: #333;
      color: #fff;
      border: none;
      padding: 7px;
      font-size: 14px;
      resize: vertical;
    }
    label {
      display: block;
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: bold;
      color: #f8b500;
    }
    .summary {
      background-color: #2e2e2e;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 14px;
      color: #f8b500;
    }
    .progress-field {
      background-color: #2d2d2d !important;
      font-weight: bold;
      color: #f8b500 !important;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Ø¬Ø¯ÙˆÙ„ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¹ Bar ÙˆDumbbell</h2>
  <div class="week-selector">
    <label for="weekSelect">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</label>
    <select id="weekSelect"></select>
    <button onclick="addWeek()">â• Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹</button>
    <button onclick="exportPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
    <button onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  </div>
  <div id="weeksContainer"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script>
  const daysOfWeek = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];

  let data = {
    weeks: [
      {
        name: "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1",
        days: {
          "Ø§Ù„Ø³Ø¨Øª": [
            {name:"Ø³ÙƒÙˆØ§Øª Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø¯Ø§Øª - Home Game", sessions:"3", reps:"12", weight:"0", percent:"0", duration:"10", progress:"0"},
            {name:"Ø¨Ø±ÙŠØ³ Ø§Ù„ØµØ¯Ø± Ø¨Ø§Ù„Ø¨Ø§Ø± - Bar", sessions:"3", reps:"10", weight:"20", percent:"70", duration:"15", progress:"0"},
            {name:"ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¹Ø¶Ù„Ø© Ø°Ø§Øª Ø§Ù„Ø±Ø£Ø³ÙŠÙ† Ø¯Ù…Ø¨Ù„ - Dumbbell", sessions:"3", reps:"12", weight:"8", percent:"75", duration:"10", progress:"0"}
          ],
          "Ø§Ù„Ø£Ø­Ø¯": [
            {name:"Ø¬Ø±ÙŠ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† - Home Game", sessions:"4", reps:"30", weight:"0", percent:"0", duration:"15", progress:"0"},
            {name:"Ø¯ÙŠØ¯Ù„ÙŠÙØª Ø¨Ø§Ù„Ø¨Ø§Ø± - Bar", sessions:"3", reps:"8", weight:"40", percent:"80", duration:"20", progress:"0"},
            {name:"Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¯Ù…Ø¨Ù„ - Dumbbell", sessions:"3", reps:"15", weight:"5", percent:"70", duration:"10", progress:"0"}
          ]
        }
      }
    ]
  };

  const exerciseSuggestions = {
    "Bar": [
      { name: "Ø³ÙƒÙˆØ§Øª Ø¨Ø§Ù„Ø¨Ø§Ø±", sessions: "3", reps: "8", weight: "40", percent: "80" },
      { name: "Ø¯ÙŠØ¯Ù„ÙŠÙØª Ø¨Ø§Ù„Ø¨Ø§Ø±", sessions: "3", reps: "6", weight: "45", percent: "85" },
      { name: "Ø¶ØºØ· Ø¹Ø³ÙƒØ±ÙŠ Ø¨Ø§Ù„Ø¨Ø§Ø±", sessions: "3", reps: "8", weight: "30", percent: "75" }
    ],
    "Dumbbell": [
      { name: "ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØµØ¯Ø± Ø¨Ø§Ù„Ø¯Ù…Ø¨Ù„", sessions: "3", reps: "10", weight: "10", percent: "75" },
      { name: "Ø±ÙØ¹ Ø§Ù„Ø¯Ù…Ø¨Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰", sessions: "3", reps: "12", weight: "6", percent: "70" },
      { name: "Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¯Ù…Ø¨Ù„", sessions: "3", reps: "15", weight: "5", percent: "70" }
    ],
    "Home Game": [
      { name: "Ø¨ÙˆØ´ Ø£Ø¨", sessions: "4", reps: "15", weight: "0", percent: "0" },
      { name: "Ù‚ÙØ² Ø§Ù„Ø­Ø¨Ù„", sessions: "5", reps: "50", weight: "0", percent: "0" },
      { name: "Ø´Ø¯ Ø¬Ø³Ù…", sessions: "3", reps: "12", weight: "0", percent: "0" }
    ]
  };

  function saveData() {
    localStorage.setItem("gymWeeklyData", JSON.stringify(data));
  }

  function loadData() {
    const saved = localStorage.getItem("gymWeeklyData");
    if (saved) {
      data = JSON.parse(saved);
      // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù… Ù„ÙƒÙ„ ØªÙ…Ø±ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      data.weeks.forEach(week => {
        Object.values(week.days).forEach(exercises => {
          exercises.forEach(ex => {
            ex.progress = calculateProgress(ex.weight, ex.reps, ex.percent);
          });
        });
      });
    }
  }

  // âœ… Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…
  function calculateProgress(weight, reps, percent) {
    const w = parseInt(weight || 0);
    const r = parseInt(reps || 0);
    const p = parseInt(percent || 0);

    const totalLoad = w * r;
    return p > 0 ? `${totalLoad} ÙƒØº (${p}%)` : totalLoad > 0 ? `${totalLoad} ÙƒØº` : "0";
  }

  function updateExercise(weekIdx, day, exIdx, field, value) {
    // ğŸ”’ Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    if (["sessions", "reps", "weight", "percent", "duration"].includes(field)) {
      if (!/^\d*$/.test(value)) return; // ÙŠØ³Ù…Ø­ ÙÙ‚Ø· Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    }

    const exercise = data.weeks[weekIdx].days[day][exIdx];
    exercise[field] = value;

    // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…
    exercise.progress = calculateProgress(exercise.weight, exercise.reps, exercise.percent);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const containerId = `#week-${weekIdx}-day-${day}`;
    const progressInput = document.querySelector(`${containerId} tbody tr:nth-child(${exIdx + 1}) input.progress-field`);
    if (progressInput) progressInput.value = exercise.progress;

    saveData();
  }

  function deleteExercise(weekIdx, day, exIdx) {
    data.weeks[weekIdx].days[day].splice(exIdx, 1);
    saveData();
    renderWeekContent(weekIdx);
  }

  function addExercise(weekIdx, day, exercise = null) {
    const defaultEx = {
      name: "ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯",
      sessions: "1",
      reps: "10",
      weight: "0",
      percent: "0",
      duration: "10",
      progress: "0"
    };
    const newEx = exercise || defaultEx;
    newEx.progress = calculateProgress(newEx.weight, newEx.reps, newEx.percent);
    data.weeks[weekIdx].days[day].push(newEx);
    saveData();
    renderWeekContent(weekIdx);
  }

  function createDayTable(weekIdx, day) {
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    const headers = ["Ø§Ù„ØªÙ…Ø±ÙŠÙ†", "Ø§Ù„Ø¬Ù„Ø³Ø§Øª", "Ø§Ù„ØªÙƒØ±Ø§Ø±", "Ø§Ù„ÙˆØ²Ù† (ÙƒØº)", "Ø§Ù„Ù†Ø³Ø¨Ø© %", "Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)", "Ø§Ù„ØªÙ‚Ø¯Ù…", "Ø¥Ø²Ø§Ù„Ø©"];
    headers.forEach(text => {
      const th = document.createElement("th");
      th.textContent = text;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    const exercises = data.weeks[weekIdx].days[day] || [];

    exercises.forEach((ex, exIdx) => {
      const tr = document.createElement("tr");

      // Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†
      const tdName = document.createElement("td");
      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.value = ex.name;
      nameInput.oninput = e => updateExercise(weekIdx, day, exIdx, "name", e.target.value);
      tdName.appendChild(nameInput);
      tr.appendChild(tdName);

      // Ø§Ù„Ø¬Ù„Ø³Ø§Øª / Ø§Ù„ØªÙƒØ±Ø§Ø± / Ø§Ù„ÙˆØ²Ù† / Ø§Ù„Ù†Ø³Ø¨Ø© / Ø§Ù„Ù…Ø¯Ø©
      ["sessions", "reps", "weight", "percent", "duration"].forEach(field => {
        const td = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.min = "0";
        input.pattern = "[0-9]*";
        input.value = ex[field];
        input.oninput = e => updateExercise(weekIdx, day, exIdx, field, e.target.value);
        td.appendChild(input);
        tr.appendChild(td);
      });

      // Ø§Ù„ØªÙ‚Ø¯Ù…
      const tdProgress = document.createElement("td");
      const progressInput = document.createElement("input");
      progressInput.type = "text";
      progressInput.readOnly = true;
      progressInput.className = "progress-field";
      progressInput.value = ex.progress;
      tdProgress.appendChild(progressInput);
      tr.appendChild(tdProgress);

      // Ø²Ø± Ø§Ù„Ø­Ø°Ù
      const tdDelete = document.createElement("td");
      const delBtn = document.createElement("button");
      delBtn.textContent = "Ø­Ø°Ù";
      delBtn.className = "delete-exercise";
      delBtn.onclick = () => deleteExercise(weekIdx, day, exIdx);
      tdDelete.appendChild(delBtn);
      tr.appendChild(tdDelete);

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    return table;
  }

  function createDaySection(weekIdx, day) {
    const section = document.createElement("div");
    section.id = `week-${weekIdx}-day-${day}`;
    section.className = "day-section";

    const title = document.createElement("h3");
    title.textContent = day;
    section.appendChild(title);

    section.appendChild(createDayTable(weekIdx, day));

    // Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
    const dropdown = document.createElement("select");
    dropdown.innerHTML = `<option value="">Ø§Ø®ØªÙŠØ§Ø± ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯</option>`;
    Object.keys(exerciseSuggestions).forEach(category => {
      exerciseSuggestions[category].forEach(ex => {
        const option = document.createElement("option");
        option.value = JSON.stringify({...ex, duration: "15"});
        option.textContent = `${ex.name} (${category})`;
        dropdown.appendChild(option);
      });
    });

    dropdown.onchange = () => {
      if (dropdown.value) {
        const selectedEx = JSON.parse(dropdown.value);
        addExercise(weekIdx, day, selectedEx);
      }
    };

    section.appendChild(dropdown);

    // Ø²Ø± Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠÙ† ÙØ§Ø±Øº
    const addBtn = document.createElement("button");
    addBtn.textContent = "â• Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠÙ† ÙØ§Ø±Øº";
    addBtn.onclick = () => addExercise(weekIdx, day);
    section.appendChild(addBtn);

    // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…
    const notesLabel = document.createElement("label");
    notesLabel.textContent = "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…:";
    section.appendChild(notesLabel);

    const notesTextarea = document.createElement("textarea");
    notesTextarea.value = data.weeks[weekIdx].days[day].notes || "";
    notesTextarea.placeholder = "Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§...";
    notesTextarea.oninput = e => {
      data.weeks[weekIdx].days[day].notes = e.target.value;
      saveData();
    };
    section.appendChild(notesTextarea);

    return section;
  }

  function renderWeekContent(weekIdx) {
    const container = document.getElementById("weeksContainer");
    container.innerHTML = "";
    const week = data.weeks[weekIdx];
    if (!week) return;

    daysOfWeek.forEach(day => {
      if (!week.days[day]) week.days[day] = [];
      if (!week.days[day].notes) week.days[day].notes = "";
      container.appendChild(createDaySection(weekIdx, day));
    });
  }

  function renderWeekSelector() {
    const select = document.getElementById("weekSelect");
    select.innerHTML = "";
    data.weeks.forEach((w, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = w.name;
      select.appendChild(opt);
    });
    select.onchange = () => renderWeekContent(select.value);
    if (select.options.length > 0) {
      select.selectedIndex = 0;
      renderWeekContent(0);
    }
  }

  function addWeek() {
    const newWeekName = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${data.weeks.length + 1}`;
    const newDays = {};
    daysOfWeek.forEach(day => newDays[day] = []);
    data.weeks.push({ name: newWeekName, days: newDays });
    saveData();
    renderWeekSelector();
    selectWeek(data.weeks.length - 1);
  }

  function selectWeek(idx) {
    const select = document.getElementById("weekSelect");
    select.value = idx;
    renderWeekContent(idx);
  }

  function clearAllData() {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
      localStorage.removeItem("gymWeeklyData");
      data = { weeks: [] };
      addWeek();
      renderWeekSelector();
    }
  }

  function exportPDF() {
    alert("Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF ØºÙŠØ± Ù…ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±.");
  }

  loadData();
  if (data.weeks.length === 0) addWeek();
  renderWeekSelector();
</script>
</body>
</html>
